const auto=null!==getURLParameter(location.search,"auto"),messages={"auto-sign-in-to-b5":handleAutoSignInToB5,"initialize-device":handleDeviceInit,lock:()=>{},"display-mfa-required":handleDisplayMFARequired};function isTrusted1PasswordDomain(){let e=window.location.hostname;if(!e)return!1;e=e.toLowerCase();const t=["1password.com","1password.eu","1password.ca","b5dev.com","b5test.com","b5staging.com","b5local.com"];for(let n of t)if(e===n||e.endsWith("."+n))return!0;return!1}function handleAutoSignInToB5(e){isTrusted1PasswordDomain()&&document.dispatchEvent(new CustomEvent("B5InitializeSession",{detail:createEventDetail(e.data)}))}function handleDeviceInit(e){isTrusted1PasswordDomain()&&document.dispatchEvent(new CustomEvent("B5InitializeDevice",{detail:createEventDetail(e.data.device)}))}function handleDisplayMFARequired(e){if(!isTrusted1PasswordDomain())return;let t;const n=new MutationObserver(()=>{var i,o,a;if(null===(o=null===(i=document.getElementById("signin-form"))||void 0===i?void 0:i.firstElementChild)||void 0===o?void 0:o.classList.contains("two-factor-entry"))null===(a=t)||void 0===a||a.remove(),n.disconnect();else{const n=document.getElementsByClassName("existing-signin")[0];n&&0===document.getElementsByClassName("lock-message").length&&((t=document.createElement("div")).classList.add("lock-message","box","red"),t.textContent=e.data.content,n.insertBefore(t,n.firstChild))}});n.observe(document.body,{childList:!0,subtree:!0})}function closeNotification(e){const t=document.querySelector(`iframe[src="${e}"]`);t&&document.body.removeChild(t)}function showNotification(e){createNotification("b5x-notification",e)}function createNotification(e,t){let n=document.createElement("iframe");return n.id=e,t&&(n.src=t),document.body.appendChild(n),n}chrome.runtime.onMessage.addListener((e,t,n)=>e.name in messages&&(messages[e.name](e,n),!0));const spoofablePageEvents={B5WebReady:handleUntrustedB5Ready,B5SignInSucceeded:handleUntrustedB5SignInSucceeded};function handleUntrustedB5Ready(e){if(!isTrusted1PasswordDomain())return;let t=e.detail;t.capabilities.DeviceInit&&chrome.runtime.sendMessage({name:"b5Ready",data:{deviceInit:t.capabilities.DeviceInit,sessionInit:t.capabilities.SessionInit}})}function handleUntrustedB5SignInSucceeded(e){if(!isTrusted1PasswordDomain())return;let t=e.detail;t.signinAddress=window.location.origin;const n={name:"sign-in-succeeded",data:{details:t}};chrome.runtime.sendMessage(n),chrome.runtime.onMessage.addListener(e=>{"show-add-account-prompt"===e.name&&showNotification(e.data),"close-add-account-prompt"===e.name&&closeNotification(e.data)})}for(let e in spoofablePageEvents)document.addEventListener(e,spoofablePageEvents[e]);function createEventDetail(e){return"function"==typeof cloneInto?cloneInto(e,window.document):e}function getURLParameter(e,t){let n=e.match("[?&]"+t+"=([^&]+)");return n?n[1]:null}document.dispatchEvent(new CustomEvent("B5OPXReady",{bubbles:!1,cancelable:!1,detail:createEventDetail({capabilities:{CustomAutosave:!0,SessionInit:1,DeviceInit:1}})})),chrome.runtime.sendMessage({name:"getBuildNumber"},e=>{document.body.dataset.onepasswordExtensionVersion=e});